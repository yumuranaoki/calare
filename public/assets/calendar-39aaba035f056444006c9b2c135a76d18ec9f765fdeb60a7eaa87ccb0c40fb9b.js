path=location.pathname,console.log(path),$(document).ready(function(){delete_event=function(e){$.ajaxPrefilter(function(e,t,a){var n;if(!e.crossDomain&&(n=$('meta[name="csrf-token"]').attr("content")))return a.setRequestHeader("X-CSRF-Token",n)}),$.ajax({type:"post",url:"/deleteevent",data:{id:e,_method:"DELETE"}}).done(function(){alert("\u524a\u9664\u3057\u307e\u3057\u305f!")}).fail(function(){alert("\u524a\u9664\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002")})},create_event=function(e,t,a,n){$.ajaxPrefilter(function(e,t,a){var n;if(!e.crossDomain&&(n=$('meta[name="csrf-token"]').attr("content")))return a.setRequestHeader("X-CSRF-Token",n)}),$.ajax({type:"post",url:"/createevent",data:{title:e,start:t.toISOString(),end:a.toISOString(),calendar_id:n}}).done(function(){alert("\u767b\u9332\u3057\u307e\u3057\u305f!")}).fail(function(){alert("\u767b\u9332\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002")})},edit_event=function(e,t,a){$.ajaxPrefilter(function(e,t,a){var n;if(!e.crossDomain&&(n=$('meta[name="csrf-token"]').attr("content")))return a.setRequestHeader("X-CSRF-Token",n)}),$.ajax({type:"post",url:"/editevent",data:{start:e.toISOString(),end:t.toISOString(),id:a,_method:"PATCH"}}).done(function(){alert("\u5909\u66f4\u3057\u307e\u3057\u305f!")}).fail(function(){alert("\u5909\u66f4\u3067\u304d\u307e\u305b\u3093\u3067\u3057\u305f\u3002")})},$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"agendaWeek,month"},defaultView:"agendaWeek",allDayText:"all day",dayNamesShort:["\u65e5","\u6708","\u706b","\u6c34","\u6728","\u91d1","\u571f"],views:{week:{titleFormat:"YYYY\u5e74M\u6708"},month:{titleFormat:"YYYY\u5e74M\u6708"},day:{titleFormat:"YYYY\u5e74M\u6708D\u65e5"}},eventClick:function(e){alert("Event: "+e.id),confirm("are you sure to delete?")&&($("#calendar").fullCalendar("removeEvents",e.id),delete_event(e.id))},selectable:!0,selectHelper:!0,select:function(e,t){for(var a=prompt("\u30a4\u30d9\u30f3\u30c8\u3092\u8ffd\u52a0"),n=25,r="abcdefghijklmnopqrstuv0123456789",o=r.length,l="",i=0;i<n;i++)l+=r[Math.floor(Math.random()*o)];var d;a&&(d={title:a,start:e,end:t},$("#calendar").fullCalendar("renderEvent",d,!0),$("#calendar").fullCalendar("unselect"),create_event(a,e,t,l))},editable:!0,eventResize:function(e){var t=e.start,a=e.end,n=e.id;edit_event(t,a,n)},navLinks:!0,timeFormat:"H:mm",slotLabelFormat:"H:mm",timezone:"Asia/Tokyo",events:path+"/events.json"})});